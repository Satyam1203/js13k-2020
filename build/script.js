let s=32;const canvas=document.getElementById("game"),ctx=canvas.getContext("2d"),CANVAS_WIDTH=640,CANVAS_HEIGHT=640;let game_over=0,level=1;const player_object=document.getElementById("player_object"),food_object=document.getElementById("food_object"),monster_object=document.getElementById("monster_object");let direction="r";class Player{constructor(e){this.size=e,this.x=CANVAS_WIDTH/2-this.size,this.y=CANVAS_HEIGHT-this.size,ctx.fillStyle="black"}draw(){ctx.drawImage(player_object,this.x,this.y,this.size,this.size)}update(e){ctx.clearRect(this.x,this.y,this.size,this.size),"r"===e?this.x+2*this.size<=CANVAS_WIDTH&&(this.x+=this.size):"b"===e?this.y+this.size<CANVAS_WIDTH&&(this.y+=this.size):"l"===e?this.x-this.size>=0&&(this.x-=this.size):"t"===e&&this.y>0&&(this.y-=this.size),ctx.fillStyle="black",ctx.drawImage(player_object,this.x,this.y,this.size,this.size)}destination(){return this.x===final.x&&this.y===final.y}}class Obstacle{constructor(e,t,i,o){this.x=e,this.y=t,this.size=i,this.speed=o,ctx.fillStyle="white",ctx.fillRect(this.x,this.y,this.size,s)}move(){ctx.clearRect(this.x,this.y,this.size,s),ctx.fillStyle="white",this.x+=this.speed,this.x>=640-this.size&&(this.speed=-this.speed),this.x<=0&&(this.speed=-this.speed),ctx.fillRect(this.x,this.y,this.size,s)}colloide(){return(player.y-32===this.y||player.y===this.y||player.y+32===this.y)&&player.x+32>=this.x&&player.x<=this.x+this.size}}class Monster{constructor(){this.size=64,this.posy=192,this.posx=CANVAS_WIDTH-this.size,this.speed=-3,this.isRemoved=0,ctx.drawImage(monster_object,this.posx,this.posy,this.size,this.size)}move(){ctx.clearRect(this.posx,this.posy,this.size,this.size),this.posy+=this.speed,this.posy>=640-this.size&&(this.speed=-this.speed),this.posy<=0&&(this.speed=-this.speed),ctx.drawImage(monster_object,this.posx,this.posy,this.size,this.size)}remove(){ctx.clearRect(this.posx,this.posy,this.size,this.size)}killed(){ctx.clearRect(this.posx,this.posy,this.size,this.size)}}class Fruit{constructor(){for(this.val=0,this.x=32*Math.floor(640*Math.random()/32),this.y=32*Math.floor(640*Math.random()/32);96===this.y||224===this.y||352===this.y||480===this.y;)this.y=32*Math.floor(640*Math.random()/32);for(;0===this.y&&608===this.x||608===this.y&&288===this.x;)this.x=32*Math.floor(640*Math.random()/32);ctx.fillStyle="yellow",ctx.fillRect(this.x,this.y,32,32),ctx.drawImage(food_object,this.x,this.y,32,32)}eaten(){return this.x===player.x&&this.y===player.y}displaceFood(){this.val=1,this.x=-32,this.y=-32}}class Bullet{constructor(){this.x=8,this.y=8,this.fired=0,this.posx=0,this.posy=0}initialize(){this.fired=1,this.posx=player.x+32,this.posy=player.y+12,ctx.fillStyle="red",ctx.fillRect(this.posx,this.posy,this.x,this.y)}fire(){ctx.clearRect(this.posx,this.posy,this.x,this.y),this.posx>CANVAS_WIDTH-64?(this.fired=0,this.posx=-16):this.posx+=16,ctx.fillStyle="red",ctx.fillRect(this.posx,this.posy,this.x,this.y)}kills(e){return this.posx>e.posx&&this.posy>=e.posy&&this.posy<=e.posy+e.size&&(this.fired=0,!0)}}const round_details=[{description:"Billy wants to go to other village and on his way, he finds a field of apple. He loves apples and he wants to eat all of them present in the field but there are some obstacles preventing him on his way to the destination. Help him go to other village by <b>avoiding obtacles</b>(not even touch them). The door(marked green) can be used once per level after eating all apples."},{description:"While eating the apples, the field owner saw him and tied him(now he <b>can only move vertically</b>). A monster is here to keep an eye on him & prevent him from escaping. He has 5 bullets and he has to hit atleast 3 to the monster and then he can easily move(horizontally too) and get out of this field to reach his destination village(marked green). Help him do so. <p>Use Spacebar to shoot</p>"}];document.getElementById("level").innerHTML=1,document.getElementById("desc").innerHTML=round_details[0].description;const drawNotFound=()=>{ctx.font="80px sans-serif",ctx.fillStyle="white",ctx.fillText("404 - Not Found!",20,CANVAS_HEIGHT/2)},drawFound=()=>{ctx.font="80px sans-serif",ctx.fillStyle="white",ctx.fillText("200 - Found!",75,CANVAS_HEIGHT/2)};class FinalState{constructor(){this.x=608,this.y=0}draw(e){this.y=e,ctx.fillStyle="green",ctx.fillRect(this.x,this.y,32,32)}}let player=new Player(32);const final=new FinalState,restart=()=>window.location.reload();ctx.font="80px sans-serif",ctx.fillStyle="white",ctx.fillText("404 - Not Found!",20,CANVAS_HEIGHT/2);const play=()=>{1===level?level1():(level2(),document.getElementById("level").innerHTML=2,document.getElementById("desc").innerHTML=round_details[1].description)},level1=()=>{ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),player.draw(),final.draw(0),window.event.target.disabled=!0,game_over=0;let e=new Obstacle(32,96,192,Math.floor(12*Math.random())+10),t=new Obstacle(160,352,160,Math.floor(12*Math.random())+10),i=new Obstacle(224,224,184,Math.floor(12*Math.random())+10),s=new Obstacle(320,480,160,Math.floor(12*Math.random())+10),o=new Fruit,l=new Fruit,n=new Fruit,a=new Fruit;document.onkeydown=function(e){game_over||(37===e.keyCode||65===e.keyCode?(direction="l",player.update(direction)):38===e.keyCode||87===e.keyCode?(direction="t",player.update(direction)):39===e.keyCode||68===e.keyCode?(direction="r",player.update(direction)):40!==e.keyCode&&83!==e.keyCode||(direction="b",player.update(direction)))};var r=setInterval(()=>(e.move(),t.move(),i.move(),s.move(),e.colloide()||t.colloide()||i.colloide()||s.colloide()?(game_over=1,clearInterval(r),void(document.getElementById("status").innerText="Game Over")):(o.eaten()&&o.displaceFood(),l.eaten()&&l.displaceFood(),n.eaten()&&n.displaceFood(),a.eaten()&&a.displaceFood(),player.destination()&&o.val&&l.val&&n.val&&a.val?(ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),clearInterval(r),void(1===(level=2)?level1():(level2(),document.getElementById("level").innerHTML=2,document.getElementById("desc").innerHTML=round_details[1].description))):void 0)),20)},level2=()=>{ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),game_over=0,player.x=0,player.y=CANVAS_HEIGHT/2,player.draw();let e=0,t=0,i=new Bullet,s=new Monster;document.getElementById("score").innerText=`Bullets Remaining - ${5-e}, Hits - ${t}`,document.onkeydown=function(o){if(!game_over)if(38===o.keyCode||87===o.keyCode)direction="t",player.update(direction);else if(40===o.keyCode||83===o.keyCode)direction="b",player.update(direction);else if(37!==o.keyCode&&65!==o.keyCode||!s.isRemoved)if(39!==o.keyCode&&68!==o.keyCode||!s.isRemoved){if(32===o.keyCode){if(e>=5)return;!i.fired&&(i.posx>=CANVAS_WIDTH-s.size||i.posx<=0)&&(e++,i.initialize(),document.getElementById("score").innerText=`Bullets Remaining - ${5-e}, Hits - ${t}`)}}else direction="r",player.update(direction);else direction="l",player.update(direction)};var o=setInterval(()=>(s.move(),i.fired&&(i.fire(),i.kills(s)&&(s.killed(),t++,s.speed<0?s.speed-=2:s.speed+=2,document.getElementById("score").innerText=`Bullets Remaining - ${5-e}, Hits - ${t}`)),3===t&&(s.remove(),s.isRemoved=1,final.draw(CANVAS_HEIGHT-32)),player.x===final.x&&player.y===final.y?(document.getElementById("status").style.color="green",document.getElementById("status").innerText="Thanks for helping billy!!",ctx.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),clearInterval(o),ctx.font="80px sans-serif",ctx.fillStyle="white",void ctx.fillText("200 - Found!",75,CANVAS_HEIGHT/2)):5!==e||i.fired||s.isRemoved?void 0:(game_over=1,clearInterval(o),void(document.getElementById("status").innerText="Game Over"))),20)};